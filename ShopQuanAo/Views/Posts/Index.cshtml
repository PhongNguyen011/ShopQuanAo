@model List<ShopQuanAo.Models.Post>
@using System.Text.RegularExpressions
@{
    ViewData["Title"] = "Bài viết";

    string Excerpt(string? html, int max = 250)
    {
        var text = Regex.Replace(html ?? string.Empty, "<.*?>", string.Empty); // bỏ tag HTML
        text = text.Replace("&nbsp;", " ").Trim();
        return text.Length > max ? text.Substring(0, max) + "..." : text;
    }
    string Img(string? f) => Url.Content(string.IsNullOrEmpty(f) ? "~/images/_placeholder.png" : $"~/images/posts/{f}");
}


<div class="container">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs d-flex flex-row align-items-center mb-3" aria-label="breadcrumb">
        <ul class="mb-0">
            <li><a asp-area="" asp-controller="Home" asp-action="Index">Trang Chủ</a></li>
            <li class="active"><a href="#" aria-current="page"><i class="fa fa-angle-right" aria-hidden="true"></i> @ViewData["Title"]</a></li>
        </ul>
    </nav>

    @if (Model == null || Model.Count == 0)
    {
        <div class="alert alert-info mb-0">
            Chưa có bài viết nào.
        </div>
    }
    else
    {
        <section class="mt-3">
            @foreach (var p in Model)
            {
                var isNew = (DateTime.Now - p.CreatedAt).TotalDays <= 7; // hiển thị "Mới" nếu trong 7 ngày
                <article class="post-card row g-3 align-items-stretch mt-3">
                    <!-- Ảnh bên trái -->
                    <div class="col-12 col-md-4">
                        <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug"
                        class="d-block post-thumb ratio ratio-16x9">
                            <img src="@Img(p.Thumbnail)"
                                alt="@p.Title"
                                loading="lazy"
                                decoding="async"
                                referrerpolicy="no-referrer" />
                        </a>
                    </div>

                    <!-- Nội dung bên phải -->
                    <div class="col-12 col-md-8 d-flex flex-column">
                        <div class="d-flex align-items-center gap-2 mb-1">
                            <h4 class="post-title flex-grow-1 mb-0">
                                <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug">
                                    @p.Title
                                </a>
                            </h4>
                            @if (isNew)
                            {
                                <span class="badge badge-new ms-1">Mới</span>
                            }
                        </div>

                        <div class="post-meta mb-2">
                            <i class="fa fa-calendar-o me-1" aria-hidden="true"></i>
                            @p.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                        </div>

                        <p class="post-excerpt mb-3">
                            @Excerpt(p.Content, 260)
                        </p>

                        <div class="post-actions mt-auto">
                            <a class="btn btn-outline-primary btn-sm px-3"
                               asp-controller="Posts"
                               asp-action="Details"
                               asp-route-slug="@p.Slug"
                               aria-label="Đọc tiếp: @p.Title">
                                Đọc tiếp
                            </a>
                        </div>
                    </div>
                </article>
            }
        </section>
    }
</div>
