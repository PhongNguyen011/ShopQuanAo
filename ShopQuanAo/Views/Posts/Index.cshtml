@model List<ShopQuanAo.Models.Post>
@using System.Text.RegularExpressions
@{
    ViewData["Title"] = "Bài viết";
    string Excerpt(string? html, int max = 250)
    {
        var text = Regex.Replace(html ?? string.Empty, "<.*?>", string.Empty); // bỏ tag HTML
        text = text.Replace("&nbsp;", " ").Trim();
        return text.Length > max ? text.Substring(0, max) + "..." : text;
    }
    string Img(string? f) => Url.Content(string.IsNullOrEmpty(f) ? "~/images/_placeholder.png" : $"~/images/posts/{f}");
}

<div class="container my-4">
    <h3 class="mb-3">Bài viết</h3>

    @if (Model == null || Model.Count == 0)
    {
        <div class="alert alert-info">Chưa có bài viết nào.</div>
    }
    else
    {
        <section>
            @foreach (var p in Model)
            {
                <article class="row g-3 align-items-start border-bottom pb-3 mt-4">
                    <!-- Ảnh bên trái -->
                    <div class="col-md-3">
                        <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug">
                            <img src="@Img(p.Thumbnail)" alt="@p.Title"
                                 class="img-fluid rounded"
                                 style="width:100%;height:300px;object-fit:cover;border-radius:8px;" />
                        </a>
                    </div>

                    <!-- Chữ bên phải -->
                    <div class="col-md-7">
                        <h4 class="mb-1">
                            <a asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug" class="text-decoration-none text-dark">
                                @p.Title
                            </a>
                        </h4>
                        <div class="text-muted small mb-2">@p.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                        <p class="mb-2">@Excerpt(p.Content, 260)</p>
                        <a class="btn btn-sm btn-outline-primary" asp-controller="Posts" asp-action="Details" asp-route-slug="@p.Slug">
                            Đọc tiếp
                        </a>
                    </div>
                </article>
            }

        </section>
    }
</div>
